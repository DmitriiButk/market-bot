# Market-Bot

**Market-Bot** — это комплексное решение для автоматизации управления торговыми операциями через Telegram-интерфейс.
Проект представляет собой полноценную систему электронной коммерции, включающую каталог товаров, администрирование,
интеграцию с платежными системами и аналитику.

## Архитектура проекта

Проект построен на основе асинхронной архитектуры, что обеспечивает высокую производительность и отзывчивость бота даже
при большом количестве одновременных пользователей:

- Серверная часть: Django-приложение с административной панелью для управления всеми аспектами системы
- Бот-интерфейс: Асинхронный Telegram-бот на aiogram, предоставляющий пользовательский интерфейс
- Интеграционный слой: Безопасное взаимодействие между синхронными операциями Django ORM и асинхронным ботом через
  библиотеку asgiref
- Хранение данных: PostgreSQL для надежного хранения информации о товарах, заказах и пользователях

## Система каталога и управления товарами

Каталог товаров имеет иерархическую структуру:

- Категории товаров: Основные группы товаров с возможностью сортировки и активации/деактивации
- Подкатегории: Дополнительный уровень классификации внутри категорий
- Товары: Детальное описание, цены, изображения и другие характеристики
- **Система поддерживает**:
    - Фильтрацию товаров по категориям и подкатегориям
    - Пагинацию для удобного просмотра больших каталогов
    - Управление видимостью товаров (активация/деактивация)
    - Сортировку для настройки порядка отображения товаров

## Платежные интеграции

В проекте реализована полноценная интеграция с двумя ведущими платежными системами России:

- Тинькофф: Обработка платежей с поддержкой различных методов оплаты
- ЮKassa (YooKassa): Альтернативный платежный шлюз для максимального охвата

**Система обрабатывает**:

- Создание платежных ссылок
- Проверку статуса платежей
- Подтверждение успешных транзакций

## Интеграция с Google Sheets

Для аналитики и управления данными реализована интеграция с Google Sheets:

- Экспорт данных: Автоматическая выгрузка информации о товарах, заказах и продажах

---

## Быстрый старт

## Клонирование репозитория

```bash
git clone https://github.com/DmitriiButk/market-bot.git
cd market-bot
```

## Настройка переменных окружения

Создайте файл `.env` по примеру `env.example` и заполните необходимые параметры:

- Токен Telegram-бота
- Данные для подключения к базе данных PostgreSQL
- Ключи платёжных систем (Тинькофф, ЮKassa)
- Креденшелы для Google Sheets (опционально)

Так же необходимо загрузить файл
`credentials.json` с данными сервисного аккаунта Google в папку проекта для интеграции с Google Sheets и не забыть
указать ID таблицы, в которую будет производиться экспорт данных.

## Создание Docker-образов и запуск контейнеров.

Создание образа:

```bash
docker-compose build
```

Запуск контейнеров:

```bash
docker-compose up --d
```

Создание администратора для управления Django панелью приложения из терминала:

```bash
docker-compose exec web python /app/djproject/manage.py createsuperuser
```

Либо можно создать администратора из командной строки контейнера web:

```bash
python /app/djproject/manage.py createsuperuser
```

Управление Django панелью приложения:

- Перейдите по адресу `http://localhost:8000/admin/` в браузере.

## Описание работы

1. **Пользователь взаимодействует с ботом через Telegram.**
2. **Бот сохраняет и обрабатывает торговые позиции**
3. **Поддерживается интеграция с платёжными системами для автоматизации финансовых операций.**
4. **Доступны экспорт данных через Google Sheets для ведения учёта и анализа.**
5. **Встроенная система проверки подписки пользователей на необходимые каналы и группы перед предоставлением доступа к
   функционалу бота.**

## Настройки

- Все ключевые параметры указываются через переменные окружения (`.env`).
- Для интеграции с Google Sheets потребуется файл сервисного аккаунта.
- Для работы платёжных систем необходимо получить ключи у соответствующих сервисов.

## Стек технологий проекта Market-Bot

- Python — основной язык программирования проекта.
- Django — веб-фреймворк для реализации административной панели и серверной логики.
- Django ORM — работа с моделями и базой данных осуществляется через встроенную объектно-реляционную модель Django с
  использованием библиотеки asgiref для безопасного вызова синхронных функций ORM из асинхронного кода бота.
- aiogram — асинхронный Telegram Bot API фреймворк для реализации логики бота.
- PostgreSQL — реляционная база данных для хранения данных приложения.
- Docker — для контейнеризации и удобного развёртывания приложения.
- Google Sheets API — интеграция для экспорта и импорта данных через Google Таблицы.
- Тинькофф и ЮKassa (YooKassa) — платёжные системы для приёма и обработки онлайн-платежей.
- logging (стандартная библиотека Python) — система логгирования, все логи сохраняются в файл bot.log.
- .env — управление переменными окружения (секреты и настройки приложения).

## Контакты

Проект разработан: [DmitriiButk](https://github.com/DmitriiButk)
